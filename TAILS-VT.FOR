CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C			TAILS-VTF.FOR
C
C
C			RJM  11-APR-1990
C
C
C
C	Program that allows lab to input coarse and fine tails.
C	It sends ct and ft data to met files and foremans' files at end of day.	
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
	IMPLICIT INTEGER (A-Z)
C
C
	EXTERNAL UFO_OPEN
C
	STRUCTURE /SCREEN/
		UNION
			MAP
C
				CHARACTER*551 INPUT
C
			END MAP
C
			MAP
C
                                CHARACTER*10 SLOP
				CHARACTER*3  D(15,12)
C
			END MAP
C
		END UNION
C
	END STRUCTURE
C
C
	RECORD/SCREEN/ IN
C
	STRUCTURE /SCREENF/
		UNION
			MAP
C
				CHARACTER*100 INPUTF
C
			END MAP
C
			MAP
C
                                CHARACTER*10 SLOPF
				CHARACTER*3  DF(7,3)
C
			END MAP
C
		END UNION
C
	END STRUCTURE
C
C
	RECORD/SCREENF/ INF
C
	INTEGER DAT(2),ISS,IDD
C
	DOUBLE PRECISION CT(15,12),FT(7,3),SL(15,12),SLF(7,3),XX,X(100),
	1 AOIC(150),BOIC(150),AVG(15),NN,TSUM,NNC,CTA(3),FTA(3),NK(3),
	1	AVM(4),NM(4),AVY(4),NY(4),FLSIL,TLS(3),TSUX
C
	CHARACTER ASV*4,TIMX*8,ASC,ADAT*23,AD*10,SAV*120,DAYX/'1'/
	1 ,REPL(12)*4/'CT  ','CT2 ','CT4 ','CT6 ','CT8 ','CT10','CT12',
	1 'CT14','CT16','CT18','CT20','CT22'/,REPF(3)*4/'FT  ','FT2 ','FT3 '/
	2 ,BLANK/' '/,FOREMAN(3)*10,ALPH,SHDESC*7,OUTD*23,A1,AA*23,HSKEY*4,
	1 MON(12)*3/'JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP',
	1 'OCT','NOV','DEC'/
C
	INTEGER TIM,DS(2),DAT2(2),SD(2),SS(4),FD(2)
	LOGICAL LIVE
C
	INCLUDE 'FMS$EXAMPLES:FDVDEF'
C
	INTEGER  WORKSPACE( 3 ),	!General workspace
	1	 CHECKWKSP( 3 ),	!Check workspace
	2	 TCA( 3 ),		!Terminal Control Area
    	3	 GASN_FORM(500),	!Storage for memory resident form
    	4	 GASD_FORM(750), 	!Storage for memory resident form
	5	 FT_FORM(500),FORM4(1000)
C
C
	CHARACTER NAMES(4)*10,SDAT*23,WDAT*23
	INTEGER BSDAT(2),BWDAT(2)
C
C
C
c
	structure /bozo2/
c
		character*4	key		! yymm	(primary key)
		real		msil(3,31)	! mine ind. sio2 by shift,day
		real		cr12(3,31)	! crusher +1/2 by shift,day
		real 		flfr(3,31)	! flf davis tube recovery
		real		flfs(3,31)	! flf davis tube sio2
		real		fls(3,31)	! flf sio2
		real		flts(3,31)	! flot tails sio2
		real		aeff(4,3,31)	! amine efficiency by cell
c
c
	end structure
c
	record /bozo2/ hsd
C
	real SX,SF(3)
	INTEGER NF(3)
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
	OPEN (UNIT=77,FILE='USER_D:[METREP]FNAMEFILE.DAT',STATUS='OLD',
	1	ACCESS='DIRECT',RECL=512,FORM='FORMATTED')
C
C
	READ (77,20,REC=1)NAMES
20	FORMAT (4A10)
C
	CLOSE (77)
C
C
	DO 191 I=1,4
		AVM(I)=0.
		AVY(I)=0.
		NY(I)=0.
		NM(I)=0.
191	CONTINUE
C
C
	CALL FDV$ATERM( %DESCR(TCA),12 ,2)
	CALL FDV$AWKSP( %DESCR(WORKSPACE), 2000 )
	CALL FDV$LOPEN( 'met_P:TAIL', 1 )
	CALL FDV$SSIGQ( 0 )
C
C	Set all future calls to return status to the two status recording
C	variables FMSSTATUS and RMSSTATUS without having to call the 
C	the FDV$STAT routine.
C
C	CALL FDV$SSRV( FMSSTATUS, RMSSTATUS )
C	
C
CCCC	CALL FDV$READ( 'NEWTAILF', %DESCR(FT_FORM), 3000, SIZE_GAS)
CCCC	CALL FDV$READ( 'OLDTAILC', %DESCR(GASD_FORM), 3000, SIZE_GASD)
CCCC	CALL FDV$READ( 'OLDTAILF', %DESCR(FORM4), 3000, SIZE_GASD)
CCCC	CALL FDV$READ( 'NEWTAIL', %DESCR(GASN_FORM), 3000, LXX)
C
	INQUIRE (FILE='USER_D:[METREP.LINEAT]TAILS.LIS',EXIST=LIVE)
C
C
	IF (LIVE) THEN
C
C
	OPEN (UNIT=10,FILE='USER_D:[METREP.LINEAT]TAILS.LIS',
	1	STATUS='UNKNOWN',RECL=512,FORM='UNFORMATTED',ACCESS='DIRECT'
	2	,SHARED,USEROPEN=UFO_OPEN)
C
	ELSE
C
	WRITE (6,*) 'THE "TAILS.LIS" FILE IS MISSING, CALL RJM AT 7490'
C
C
	END IF
C
C
	OPEN (UNIT=80,FILE='MET_P:FLOTTAILSIO2.DAT',STATUS='UNKNOWN',
	1	RECL=24,FORM='UNFORMATTED',ACCESS='DIRECT',SHARED)
C
C
C
	CALL FDV$SPADA (0)
C
	CALL SYS$BINTIM (DAYX,SD)  !convert 24 hours to binary
C
118	WRITE (6,119)
119	FORMAT ('0','COARSE AND FINE TAILS INPUT & CORRECTION PROGRAM'/
	1 ' 1=INPUT COARSE TAILS'/' 2=INPUT FINE TAILS'/
	1 ' 3=CHANGE PRIOR INPUTS FOR COARSE TAILS'/
	1 ' 4=CHANGE PRIOR INPUTS FOR FINE TAILS'/
	1 ' 5=INPUT FLOTATION TAILS SIO2'/)
C
C
C
	READ (5,233) ASC
233	FORMAT (A)
C
	IF (ASC .LT. '5') GO TO 3355
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		FLOT TAILS SECTION
C
	IF (ASC .EQ. '6') GO TO 3399 
C
C
	CALL FDV$CDISP ('NFT')
	CALL FDV$SPON ()
C
	READ (80,REC=1,ERR=111) DAT,ISS,TLS
C
111	IF ((ISS .EQ. 3).OR.(ISS .EQ. 0)) THEN
C
		CALL LIB$ADD_TIMES (SD,DAT,DAT)		
C
		ISS=1
		TLS(1)=0
		TLS(2)=0
		TLS(3)=0
C
	ELSE
C
		ISS=ISS+1
C
	END IF
C
C
16	CALL SYS$ASCTIM (,ADAT,DAT,)
	CALL FDV$PUT (ADAT(1:11),'DATE')
	WRITE (AA(1:1),'(BN,I1)',err=517) ISS
	CALL FDV$PUT (AA(1:1),'SHIFT')
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		calc. key to read HALFSIL2.DAT file so I can save 
c                                                           flot tails sio2
	DO 809 MX=1,12
		IF (MON(MX) .EQ. ADAT(4:6)) GO TO 8091
809	CONTINUE
C
	GO TO 3000
C
8091	WRITE (HSKEY(3:4),'(I2)') MX
	IF (HSKEY(3:3) .EQ. ' ') HSKEY(3:3)='0'
C
	HSKEY(1:2)=ADAT(10:11)
C
	READ (ADAT(1:2),'(I2)') IDD
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
517	CALL FDV$GET (AA,X,'FLOT')
C
	READ (AA,'(BN,F10.0)') FLSIL
C
	CALL FDV$GET (AA,X,'REPLY')
C
	IF ((AA(1:1) .EQ. 'Y') .OR. (AA(1:1) .EQ. 'y')) GO TO 3399
	IF ((AA(1:1) .EQ. 'D') .OR. (AA(1:1) .EQ. 'd')) GO TO 3299
	IF ((AA(1:1) .EQ. 'A') .OR. (AA(1:1) .EQ. 'a')) GO TO 99
C
	GO TO 517
c
3299	CALL FDV$SPOFF ()
	call fdv$get (AA,X,'DATE')
	CALL SYS$BINTIM (AA,DAT)
C
	CALL FDV$GET (AA,X,'SHIFT')
	READ (AA(1:1),'(I1)') ISS
C
	GO TO 16
C
C
3399	CONTINUE
C
C
C
C
C
	TLS(ISS)=FLSIL
C
	WRITE (80,REC=1) DAT,ISS,TLS
C
	CLOSE (80)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		save flot tails sio2 in HALFSIL2.DAT by shift for T. LARSON
C
C
	OPEN (UNIT=91,FILE='MET_P:HALFSIL2.DAT',STATUS='OLD',
	1	ACCESS='KEYED',SHARED,ERR=3000)
C
C
C
C
333	READ (91,KEY=HSKEY,IOSTAT=M) HSD
C
C
C
	IF (.not.(M .eq. 0 .OR. M .eq. 36)) THEN
		LLC=LLC+1
		IF (LLC .EQ. 10) GO TO 3000
		CALL LIB$WAIT(2.)
		GO TO 333
	END IF
C
	HSD.FLTS(ISS,IDD)=FLSIL
C
C
	IF (M .EQ. 36) THEN
		HSD.KEY=HSKEY
		WRITE (91) HSD
	ELSE
		REWRITE (91) HSD
	END IF
C
	close (91)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C 
C
3000	IF (ISS .EQ. 3) THEN
C
	CALL SYS$ASCTIM(,ADAT,DAT,)
C                                
	IF (ADAT(1:1) .EQ. ' ') ADAT(1:1)='0'
C
C		send avg. FLOT tails to met files
C
C
	OPEN (UNIT=42,FILE='MET_P:AMIOIC'//ADAT(1:2)//'.DAT',
	1	FORM='UNFORMATTED',STATUS='UNKNOWN')
C
C
C
C
	READ (42,ERR=177)AOIC
C
C
	N=0
	TSUX=0
C
	DO 46 I=1,3
C
		IF (TLS(I) .LE. 0) GO TO 46
C
		N=N+1
		TSUX=TSUX+TLS(I)
C
46	CONTINUE
C
	IF (N .LE. 0) GO TO 3355
C
	TSUX=TSUX/N
C
	AOIC(33)=TSUX
C
C
C
	REWIND (42)
C
	WRITE (42)AOIC
C
	CLOSE (42)
C
C
C
C
C
	END IF
C
C
	GO TO 99
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		COARSE AND FINE TAILS SECTION
C
C
C
3355	READ (10,ERR=755,REC=1) DAT,INTC,CT,DAT2,INTF,FT
	GO TO 75
C
755	CALL SYS$GETTIM (DAT)
	CALL SYS$GETTIM (DAT2)
	INTC=0
	INTF=0
	WRITE (10,REC=1) DAT,INTC,CT,DAT2,INTF,FT
	WRITE (10,REC=2) DAT,INTC,CT,DAT2,INTF,FT
C
C
75	IF (ASC .EQ. '1') GOTO 100
	IF (ASC .EQ. '3') GOTO 800
	IF (ASC .EQ. '2') GOTO 400
	IF (ASC .EQ. '4') GOTO 1000
	GO TO 118
C
100	CALL FDV$CDISP('NEWTAIL')	  
C
C
C
C
	IF (INTC .EQ. 12) THEN
C
		INTC=1
C
		CALL LIB$ADD_TIMES (SD,DAT,DAT)		
	ELSE
C
		INTC=INTC+1
C
	END IF
C
C
	CALL SYS$ASCTIM(,ADAT,DAT,)
C
	IF (ADAT(1:1) .EQ. ' ') ADAT(1:1)='0'
C
	CALL FDV$PUT (ADAT(1:7)//ADAT(10:11),'CDATN',)
C
C
C
C
	J=(INTC-1)*2
	WRITE (SAV(1:2),533) J
533	FORMAT (BZ,I2)
C
	CALL FDV$PUT(SAV(1:2),'CTIMN')
C
C
	DO 33 I=1,15
C
		WRITE (AD,34) CT(I,INTC)
34		FORMAT (F4.1)
C
		CALL FDV$PUT(AD,'CT',I)
C
33	CONTINUE
C
C
109	CALL FDV$GETAL (SAV,MB)
C
C
	IF (SAV(57:57) .EQ. 'N') THEN
		CALL FDV$PUT (BLANK,'ANSC',)
		GO TO 109
	END IF
C
C
	IF (SAV(57:57) .EQ. 'y' .OR. SAV(57:57) .EQ. 'Y') GO TO 278
	GO TO 99
C
C
C
278	J=1
C
	DO 50 I=12,56,3
C
	READ (SAV(I:I+2),'(F3.0)') CT(J,INTC)
	CT(J,INTC)=CT(J,INTC)/10.
C
	J=J+1
C
50	CONTINUE
C
C
C
	IF (INTC .NE. 12) THEN
C
		WRITE(10,REC=1) DAT,INTC,CT,DAT2,INTF,FT   
		CLOSE (10)
C
C
C
	ELSE
C
C	     IT IS END OF DAY, ALL 12 VALUES ARE IN FOR COARSE TAILS
C
	READ (10,REC=2,ERR=865) DS,MM,SL,DAT2,INTF,FT
865	WRITE(10,REC=2) DAT,INTC,CT,DAT2,INTF,FT   
	READ (10,REC=1) DS,MM,SL,DAT2,INTF,FT
	WRITE(10,REC=1) DAT,INTC,CT,DAT2,INTF,FT   
	CLOSE (10)
C
C
C	get storage file for foremans' tails
C
	OPEN (UNIT=33,FILE='SAVED_TAILS.DAT',STATUS='OLD',ACCESS='DIRECT')
C
C
	READ (33,REC=1)NUM  	!kick up record counter by 1
		NUM=NUM+1
	WRITE (33,REC=1)NUM
C
	CALL PATTERN (DAT,SS) ! get shift no. for the crews
C
C
C
	DO 262 I=1,4
C
		IF (SS(I) .EQ. 0) GO TO 262
C
		FOREMAN(SS(I))=NAMES(I)
C
262	CONTINUE
C
C
	DO 877 I=1,3
		NK(I)=0
877		CTA(I)=0
C
C
	N=0
C
	DO 485 M=1,12,4
C
		N=N+1
C
	DO 485 L=M,M+3
	DO 485 K=1,15
C
		IF (CT(K,L) .LE. 0) GOTO 485
C
		CTA(N)=CTA(N)+CT(K,L)
		NK(N)=NK(N)+1.
C
485	CONTINUE
C
C
	DO 2486 M=1,3
		IF (NK(M) .LE. 0) GO TO 2486
		CTA(M)=CTA(M)/NK(M)
2486	CONTINUE
C
C
	WRITE (33,REC=NUM)'C',DAT,FOREMAN,CTA
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		section to calc. month and year avg coarse tails
C
C
677	READ (33,REC=1)NUM
C
C
	NNN=0
C
	DO 300 I=NUM,2,-1
C
		READ (33,REC=I)A1,DAT,FOREMAN,CTA
C
		IF (A1 .NE. 'C') GO TO 300
C
		IF (NNN .NE. 0) GO TO 62
C
			CALL SYS$ASCTIM(,SDAT,DAT,)!get beginning date in ascii
C
			NNN=1
C
C
62		CALL SYS$ASCTIM(,WDAT,DAT,)
C
C
C
C			loop thru all 3 shifts and get month & year avgs.
C
		DO 65 ISH=1,3
c
			DO 55 M=1,4
C
				IF (FOREMAN(ISH) .EQ. NAMES(M)) GO TO 9122
C
55			CONTINUE
C
			GO TO 65	! NO MATCH ON NAME
C
9122		IF (WDAT(4:11) .EQ. SDAT(4:11)) THEN
C                                                        	MONTH AVG.
			AVM(M)=AVM(M)+CTA(ISH)
			NM(M)=NM(M)+1.
C
		END IF
C
C
		IF (WDAT(8:11) .EQ. SDAT(8:11)) THEN
C                                                        	YEAR AVG.
			AVY(M)=AVY(M)+CTA(ISH)
			NY(M)=NY(M)+1.
C
		END IF
C
C
C
65		CONTINUE
C
C
300	CONTINUE
C
C
C		get month and year ct avg by foreman.
C
	DO 58 I=1,4
C
		IF (NM(I) .GT. 0) AVM(I)=AVM(I)/NM(I)
		IF (NY(I) .GT. 0) AVY(I)=AVY(I)/NY(I)
C
58	CONTINUE       	
C
	CLOSE (33)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
CCCCCCCCCCCCCCCCCCCCCCCC
C
	IF (ADAT(1:1) .EQ. ' ') ADAT(1:1)='0'
C
C		send avg. coarse tails to met files
C
C
	OPEN (UNIT=42,FILE='MET_P:AMIOIC'//ADAT(1:2)//'.DAT',
	1	FORM='UNFORMATTED',STATUS='UNKNOWN')
C
C
	OPEN (UNIT=43,FILE='MET_P:BMIOIC'//ADAT(1:2)//'.DAT',
	1	FORM='UNFORMATTED',STATUS='UNKNOWN')
C
C
	READ (42,ERR=177)AOIC
C
177	READ (43,ERR=978)BOIC
C
C
C
C
978	DO 293 J=1,15
	AVG(J)=0
	NN=0
	DO 292 K=1,12
C
		IF (CT(J,K) .LE. 0)  GOTO 292
C
		NN=NN+1
C
		AVG(J)=AVG(J)+CT(J,K)
C
292	CONTINUE
C
	IF (NN .EQ. 0) THEN
C
		AVG(J)=0
C
	ELSE
C
		AVG(J)=AVG(J)/NN
C
	END IF		
C
C
C
293	CONTINUE
C
C
C
	L=4
	DO 89 M=1,9
	AOIC(L)=AVG(M)
C
89	L=L+1
C
C
	L=10

	DO 90 M=1,6
C
	BOIC(M)=AVG(L)
C
90	L=L+1
C
C
	REWIND (42)
	REWIND (43)
C
	WRITE (42)AOIC
C
	WRITE (43)BOIC
C
C
	END IF
C
C
CCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C	collect data to output to conc control room every shift.
C
C
	IF ((INTC.EQ.4).OR.(INTC.EQ.8).OR.(INTC.EQ.12)) THEN
C
	NNC=0
	DO 488 I=1,15
	DO 488 J=INTC-3,INTC
C
		IF (CT(I,J) .LE. 0) GO TO 488
C
		TSUM=TSUM+CT(I,J)
		NNC=NNC+1
C
488	CONTINUE
C
C
C
		IF (NNC .LE. 0) GO TO 99
C
		TSUM=TSUM/NNC
C
		ISHIFT=INTC/4
C
	M6=0
C
		OPEN (UNIT=89,FILE='LTA042:',STATUS='UNKNOWN',ERR=6621)
C
C
C
		WRITE (89,511,ERR=6621)ADAT(1:11),ISHIFT,TSUM
C
511	FORMAT (' ',A11,
	1	'  SHIFT ',I1,'  PLANT AVERAGE COARSE TAILS MAG FE= ',
	1	F4.1////)
C
C
C
C
	END IF
C
C
C		if its 3rd shift output month and year ct averages
C
6621	IF (INTC .EQ. 12) THEN
C
C
C
		WRITE (89,477,ERR=99) ADAT(1:11),NAMES(1),AVM(1),AVY(1),
	1	NAMES(2),AVM(2),AVY(2),NAMES(3),AVM(3),AVY(3),
	1	NAMES(4),AVM(4),AVY(4)
C
477	FORMAT('0','MONTH AND YEAR COARSE TAILS AVERAGE THRU ',A11/
	1'0',12X,'MONTH',3X,'YEAR',4(/,' ',A10,2X,F5.2,3X,F4.2)///)
C
C
	END IF
C
C
	GO TO 99
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
400	CALL FDV$CDISP('NEWTAILF')
	CALL FDV$SPADA (0)
C	
C
C
C
	IF (INTF .EQ. 3) THEN
C
		INTF=1
C
		CALL LIB$ADD_TIMES (SD,DAT2,DAT2)
C		
	ELSE
C
		INTF=INTF+1
C
	END IF
C
C
	CALL SYS$ASCTIM(,ADAT,DAT2,)
C
	IF (ADAT(1:1) .EQ. ' ') ADAT(1:1)='0'
C
	CALL FDV$PUT (ADAT(1:7)//ADAT(10:11),'CDATF',)
C
C
	WRITE (SAV(1:2),1533) INTF
1533	FORMAT (BZ,I1)
C
	CALL FDV$PUT(SAV(1:1),'FTIMN')
C
C
	DO 733 I=1,7
C
		WRITE (AD,734) FT(I,INTF)
734		FORMAT (F4.1)
C
		CALL FDV$PUT(AD,'FT',I)
C
733	CONTINUE
C
C
909	CALL FDV$GETAL (SAV,MB)
C
C
	IF (SAV(32:32) .EQ. 'N') THEN
C
		CALL FDV$PUT (BLANK,'ANSF',)
		GO TO 909
C
	END IF
C
C
	IF (SAV(32:32) .EQ. 'y' .OR. SAV(32:32) .EQ. 'Y') GO TO 2278
	GO TO 99
C
C
C
2278	J=1
C
	DO 750 I=11,31,3
C
	READ (SAV(I:I+2),'(F3.0)') FT(J,INTF)
	FT(J,INTF)=FT(J,INTF)/10.
C
	J=J+1
C
750	CONTINUE
C
C
C
	IF (INTF .NE. 3) THEN
C
	WRITE(10,REC=1) DAT,INTC,CT,DAT2,INTF,FT   
C
C
	ELSE
C
C
	READ (10,REC=2,ERR=765) DAT,INTC,CT,D2,M2,SLF
765	WRITE(10,REC=2) DAT,INTC,CT,DAT2,INTF,FT   
	READ (10,REC=1) DAT,INTC,CT,D2,M2,SLF
	WRITE(10,REC=1) DAT,INTC,CT,DAT2,INTF,FT   
C
C
C
C
C	get storage file for foremans' tails
C
	OPEN (UNIT=33,FILE='SAVED_TAILS.DAT',STATUS='OLD',ACCESS='DIRECT')
C
C
	READ (33,REC=1)NUM  	!kick up record counter by 1
		NUM=NUM+1
	WRITE (33,REC=1)NUM
C
	CALL PATTERN (DAT2,SS) ! get shift no. for the crews
C
C
C
	DO 1262 I=1,4
C
		IF (SS(I) .EQ. 0) GO TO 1262
C
		FOREMAN(SS(I))=NAMES(I)
C
1262	CONTINUE
C
CCCCCCCCCCCCCCCC
C
C
	DO 4877 I=1,3
		NK(I)=0
4877		FTA(I)=0
C
C
C
	DO 4485 N=1,3
	DO 4485 K=1,7
C
		IF (FT(K,N) .LE. 0) GOTO 4485
C
		FTA(N)=FTA(N)+FT(K,N)
		NK(N)=NK(N)+1.
C
4485	CONTINUE
C
C
	DO 486 M=1,3
		IF (NK(M) .LE. 0) GO TO 486
		FTA(M)=FTA(M)/NK(M)
486	CONTINUE
C
C
	WRITE (33,REC=NUM)'F',DAT2,FOREMAN,FTA
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		section to calc. month and year avg FINE tails
C
C
2677	READ (33,REC=1)NUM
C
C
	NNN=0
C
	DO 1300 I=NUM,2,-1
C
		READ (33,REC=I)A1,DAT2,FOREMAN,FTA
C
		IF (A1 .NE. 'F') GO TO 1300
C
		IF (NNN .NE. 0) GO TO 162
C
		CALL SYS$ASCTIM(,SDAT,DAT2,)	!get beginning date in ascii
		NNN=1
C
162		CALL SYS$ASCTIM(,WDAT,DAT2,)
C
C
C
C			loop thru all 3 shifts and get month & year avgs.
C
		DO 165 ISH=1,3
c
			DO 155 M=1,4
C
				IF (FOREMAN(ISH) .EQ. NAMES(M)) GO TO 1122
C
155			CONTINUE
C
			GO TO 165	! NO MATCH ON NAME
C
1122		IF (WDAT(4:6) .EQ. SDAT(4:6)) THEN
C                                                        	MONTH AVG.
			AVM(M)=AVM(M)+FTA(ISH)
			NM(M)=NM(M)+1.
C
		END IF
C
C
		IF (WDAT(8:11) .EQ. SDAT(8:11)) THEN
C                                                        	YEAR AVG.
			AVY(M)=AVY(M)+FTA(ISH)
			NY(M)=NY(M)+1.
C
		END IF
C
C
C
165		CONTINUE
C
C
1300	CONTINUE
C
C
C		get month and year ct avg by foreman.
C
	DO 3258 I=1,4
C
		IF (NM(I) .GT. 0) AVM(I)=AVM(I)/NM(I)
		IF (NY(I) .GT. 0) AVY(I)=AVY(I)/NY(I)
C
3258	CONTINUE       	
C
	CLOSE (33)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
	IF (ADAT(1:1) .EQ. ' ') ADAT(1:1)='0'
C
	OPEN (UNIT=42,FILE='MET_P:AMIOIC'//ADAT(1:2)//'.DAT',
	1	FORM='UNFORMATTED',STATUS='UNKNOWN')
C
C
	OPEN (UNIT=43,FILE='MET_P:BMIOIC'//ADAT(1:2)//'.DAT',
	1	FORM='UNFORMATTED',STATUS='UNKNOWN')
C
C
	READ (42,ERR=381)AOIC
C
381	READ (43,ERR=382)BOIC
C
C
C
C
382	DO 2293 J=1,7
	AVG(J)=0
	NN=0
	DO 2292 K=1,3
C
		IF (FT(J,K) .LE. 0)  GOTO 2292
C
		NN=NN+1
C
		AVG(J)=AVG(J)+FT(J,K)
C
2292	CONTINUE
C
	IF (NN .EQ. 0) THEN
C
		AVG(J)=0
C
	ELSE
C
		AVG(J)=AVG(J)/NN
C
	END IF		
C
C
C
2293	CONTINUE
C
C
	AOIC(16)=1.1	!FIXED FT FOR LINE 4
C
	L=17
	DO 289 M=1,4
	AOIC(L)=AVG(M)
	AOIC(L+1)=AVG(M)
C
289	L=L+2
C
C
	L=7

	DO 290 M=5,7
C
	BOIC(L)=AVG(M)
	BOIC(L+1)=AVG(M)
C
290	L=L+2
C
C
C
	REWIND (42)
	REWIND (43)
C
	WRITE (42)AOIC
C
	WRITE (43)BOIC
C
C
C
C
	END IF
C
C
	CLOSE (10)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C	collect data to output to conc control room every shift.
C
C
C
	NNC=0
	DO 588 I=1,7
C
		IF (FT(I,INTF) .LE. 0) GO TO 588
C
		TSUM=TSUM+FT(I,INTF)
		NNC=NNC+1
C
588	CONTINUE
C
C
C
		IF (NNC .LE. 0) GO TO 99
C
		TSUM=TSUM/NNC
C
		ISHIFT=INTF
C
	M7=0
C
550		OPEN (UNIT=89,FILE='LTA042:',STATUS='UNKNOWN',ERR=6622)
C
C
C
		WRITE (89,611,ERR=6622) ADAT(1:11),ISHIFT,TSUM
611	FORMAT (' ',A11,
	1	'  SHIFT ',I1,'  PLANT AVERAGE FINE TAILS MAG FE= ',
	1	F4.1////)
C
C
C
C
C
C		if its 3rd shift output month and year ft averages
C
6622	IF (INTF .EQ. 3) THEN
C
C
C
		WRITE (89,1477,ERR=99) ADAT(1:11),NAMES(1),AVM(1),AVY(1),
	1	NAMES(2),AVM(2),AVY(2),NAMES(3),AVM(3),AVY(3),
	1	NAMES(4),AVM(4),AVY(4)
C
1477	FORMAT('0','MONTH AND YEAR FINE TAILS AVERAGE THRU ',A11/
	1'0',12X,'MONTH',3X,'YEAR',4(/,' ',A10,2X,F5.2,3X,F4.2)///)
C
C
	END IF
C
C
C
C
	GO TO 99
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
800	CALL FDV$CDISP ('OLDTAILC')
C
C
C
	IR=1
	READ (10,REC=IR) DAT,INTC,CT,DAT2,INTF,FT
C
C
C
C
C
C
C
C
	CALL FDV$GET (AD,TERM,'REPLY',)
C
		IF (AD(1:1) .EQ. 'P' .OR. AD(1:1) .EQ. 'p') THEN
C
			IR=2
C
			READ (10,REC=IR) DAT,INTC,CT,DAT2,INTF,FT
C
		END IF
C
C
C
	CALL SYS$ASCTIM (,ADAT,DAT,)
C
	IF (ADAT(1:1) .EQ. ' ') ADAT(1:1)='0'
C
	CALL FDV$PUT (ADAT(1:7)//ADAT(10:11),'CDAT',)
C
C
	SX=0
C
	DO 77 I=1,15
	DO 77 J=1,INTC
C
C
C			avg coarse tails
C
		IF (CT(I,J) .GT. 0) THEN
			SX=SX+CT(I,J)
			NNX=NNX+1
		END IF
C
C
C
	XX=CT(I,J)*10.	
		WRITE (AD,84,ERR=561) XX
84		FORMAT (F4.0)
C
		GO TO 562
C
561     AD='    '
C
562		CALL FDV$PUT (AD,REPL(J),I)
C
77	CONTINUE
C
C
	IF (NNX .LE. 0) GO TO 678 		!DISPLAY AVERAGE COARSE TAILS
		SX=SX/NNX
		WRITE (AD,'(F4.1)') SX
		CALL FDV$PUT (AD,'AVER')
C
C
C
678	CALL FDV$GETAL (IN.INPUT,TERM,'CT',1)
C
C
	IF (IN.INPUT(551:551) .EQ. 'A' .OR. IN.INPUT(551:551) .EQ. 'a') 
	1	GO TO 99
	IF (IN.INPUT(551:551) .EQ. 'Y' .or. IN.INPUT(551:551) .EQ. 'y') 
	1	GO TO 992
C
	CALL FDV$PUT (BLANK,'ANS3',)
	GO TO 678
C
C
992	DO 489 J=1,15
	DO 489 K=1,12
C
		READ (IN.D(J,K),451) CT(J,K)
451		FORMAT (F3.0)
C
	CT(J,K)=CT(J,K)/10.
C
489	CONTINUE
C
C
	WRITE (10,REC=IR) DAT,INTC,CT,DAT2,INTF,FT
C
	CLOSE (10)
C
C
C		check if changes were made to previous day
C
C		if they were, go send the changes to jack hunt
C
	IF (IR .EQ. 2) THEN
C
C
C			save date
C
		CALL SYS$ASCTIM(,ADAT,DAT,)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		get avg coarse tails for all 3 shifts
C
	DO 8877 I=1,3
		NK(I)=0
8877		CTA(I)=0
C
C
	N=0
C
	DO 5485 M=1,12,4
C
		N=N+1
C
	DO 5485 L=M,M+3
	DO 5485 K=1,15
C
		IF (CT(K,L) .LE. 0) GOTO 5485
C
		CTA(N)=CTA(N)+CT(K,L)
		NK(N)=NK(N)+1.
C
5485	CONTINUE
C
C
	DO 7486 M=1,3
		IF (NK(M) .LE. 0) GO TO 7486
		CTA(M)=CTA(M)/NK(M)
7486	CONTINUE
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C	get storage file for foremans' tails
C
	OPEN (UNIT=33,FILE='SAVED_TAILS.DAT',STATUS='OLD',ACCESS='DIRECT')
C
C
C
		NA=0
C
		DO 3434 I=2,400
		READ (33,REC=I,ERR=99) ALPH,FD,FOREMAN
C
		IF (ALPH .NE. 'C') GO TO 3434
C
		IF ((DAT(1) .EQ. FD(1)).AND.(DAT(2) .EQ. FD(2))) THEN
C
			WRITE (33,REC=I)ALPH,DAT,FOREMAN,CTA
C
		na=1
			CLOSE (33)
			GO TO 1818
C
		END IF
C
C
3434		CONTINUE
C
		GO TO 99
C
C
1818	IF (NA .NE. 0) THEN
	OPEN (UNIT=33,FILE='SAVED_TAILS.DAT',STATUS='OLD',ACCESS='DIRECT')
	GO TO 677
	END IF
C
C
C
C
	END IF
C
C
C
	GO TO 99
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
1000	CALL FDV$CDISP ('OLDTAILF')		
C
C
	IR=1
	READ (10,REC=IR) DAT,INTC,CT,DAT2,INTF,FT
C
C
C
C
C
	CALL FDV$GET (AD,TERM,'REPLY',)
C
		IF (AD(1:1) .EQ. 'P' .or. AD(1:1) .EQ. 'p') THEN
C
C
			IR=2
			READ (10,REC=IR) DAT,INTC,CT,DAT2,INTF,FT
C
C
C
		END IF
C
C
C
C
	CALL SYS$ASCTIM (,ADAT,DAT2,)
C
	IF (ADAT(1:1) .EQ. ' ') ADAT(1:1)='0'
C
	CALL FDV$PUT (ADAT(1:7)//ADAT(10:11),'CDAT',)
C
C
	SF(1)=0
	SF(2)=0
	SF(3)=0
	NF(1)=0
	NF(2)=0
	NF(3)=0
C
C
	DO 277 I=1,7
	DO 277 J=1,INTF
C
C
		IF (FT(I,J) .GT. 0) THEN
			SF(J)=SF(J)+FT(I,J)
			NF(J)=NF(J)+1
		END IF
C
C
	XX=FT(I,J)*10.	
		WRITE (AD,84,ERR=2561) XX
C
		GO TO 2562
C
2561     AD='    '
C
2562		CALL FDV$PUT (AD,REPF(J),I)
C
277	CONTINUE
C
C
		DO 49 MM=1,3
C
			IF(NF(MM) .LE. 0) GO TO 49
			SF(MM)=SF(MM)/NF(MM)
			WRITE (AD,'(F4.1)') SF(MM)
			CALL FDV$PUT (AD,'FTO',MM)
C
49		CONTINUE
C
C
6870	CALL FDV$GETAL (INF.INPUTF,TERM,'FT',1)
C
C
	IF (INF.INPUTF(74:74) .EQ. 'Y' .or. INF.INPUTF(74:74) .EQ. 'Y') 
	1	GO TO 409
	IF (INF.INPUTF(74:74) .EQ. 'A' .or. INF.INPUTF(74:74) .EQ. 'A')
	1	GO TO 99
C           
	CALL FDV$PUT (BLANK,'ANS3',)
	GO TO 6870
C
409	DO 4289 J=1,7
	DO 4289 K=1,3
C
		READ (INF.DF(J,K),451) FT(J,K)
C
	FT(J,K)=FT(J,K)/10.
C
4289	CONTINUE
C
C                
	WRITE (10,REC=IR) DAT,INTC,CT,DAT2,INTF,FT
C
C
	IF (IR .EQ. 2) THEN
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
		CALL SYS$ASCTIM(,ADAT,DAT2,)
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		recalculate shift avg. fine tails
C
C
	DO 4237 I=1,3
		NK(I)=0
4237		FTA(I)=0
C
C
C
	DO 4235 N=1,3
	DO 4235 K=1,7
C
		IF (FT(K,N) .LE. 0) GOTO 4235
C
		FTA(N)=FTA(N)+FT(K,N)
		NK(N)=NK(N)+1.
C
4235	CONTINUE
C
C
	DO 494 M=1,3
		IF (NK(M) .LE. 0) GO TO 494
		FTA(M)=FTA(M)/NK(M)
494	CONTINUE

CCCCCCCCCCCCCCCCCC
C
CC
C	get storage file for foremans' tails
C
	OPEN (UNIT=33,FILE='SAVED_TAILS.DAT',STATUS='OLD',ACCESS='DIRECT')
C
C
		NA=0
C
		DO 5434 I=2,400
C
		READ  (33,REC=I,ERR=99)ALPH,FD,FOREMAN
C
		IF (ALPH .NE. 'F') GO TO 5434
C
		IF ((DAT2(1) .EQ. FD(1)).AND.(DAT2(2) .EQ. FD(2))) THEN
C
			WRITE (33,REC=I)ALPH,DAT2,FOREMAN,FTA
C
		NA=1
			CLOSE (33)
			GO TO 1819
C
		END IF
C
C
5434		CONTINUE
C
		GO TO 99
C
C
1819	IF (NA .NE. 0) THEN
	OPEN (UNIT=33,FILE='SAVED_TAILS.DAT',STATUS='OLD',ACCESS='DIRECT')
	GO TO 2677
	END IF
C
C
C
	END IF
C
C
C
	CLOSE (10)
C
	GO TO 99
C
C
C
99	CALL FDV$LCLOS
CCC	CALL FDV$DEL ('NEWTAIL')
CC	CALL FDV$DEL ('NEWTAILF')
CC	CALL FDV$DEL ('OLDTAILC')
CCC	CALL FDV$DEL ('OLDTAILF')
	CALL FDV$DWKSP (%DESCR(WORKSPACE))
	CALL FDV$DTERM(%DESCR(TCA))
	CALL FDV$SPADA (0)
C
C
	STOP
	END
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	SUBROUTINE PATTERN (BTIM,SS)
C
	CHARACTER ADATE*11
	INTEGER SS(4),BTIM(2),NOFD,FNOFD(4),CTIM(2)
	INTEGER*2 NUM(7)
	INTEGER LIST(28)
	1	/1,1,1,1,1,1,1,0,0,0,0,3,3,3,3,3,3,3,0,2,2,2,2,2,2,2,0,0/
C
	CHARACTER*11   			                         
	1	FORD(4)/
	1	'02-MAR-1990',  	! #1  date that each of the four 
	2	'16-MAR-1990',      	! #2  crews start their midnight
	3	'23-MAR-1990',      	! #3   shift (shift 1)
	4	'09-MAR-1990'/           ! #4
C
C
	CALL LIB$DAY (NOFD,BTIM,)  !get day no. of passed time
C
C
	DO 44 I=1,4    	! get day no. of 4 starting dates
C
	CALL SYS$BINTIM (FORD(I),CTIM)  !convert sched. date to binary
C
44		CALL LIB$DAY (FNOFD(I),CTIM,)
C
C
	DO 45 I=1,4                	! calc shift no. of the day passed
C                                       ! to 'ADATE' for all 4 crews
C
	SS(I)=NOFD-FNOFD(I)+1  	!calc no. of days from base to now
C
	SS(I)=MOD(SS(I),28)             !get remainder after divide by 28
C
	IF (SS(I) .EQ. 0) SS(I)=28      !if remain.=0 then remain=28
C
	SS(I)=LIST(SS(I))               !get corresp. shift no. from 'list'
C
45	CONTINUE
C
C
	ICNT=0
	DO 46 I=1,4
46	IF (SS(I) .EQ. 0) ICNT=ICNT+1
C
C
	IF (ICNT .NE. 1) THEN
C
	WRITE (6,*) ' PATTERN SUBROUTINE DID NOT CALCULATE 3 SHIFTS'
	WRITE (6,*) ' CALL R.J. MAKI AT 7490'
	STOP
C
	END IF
C
C
C
	RETURN
C
C
	END
