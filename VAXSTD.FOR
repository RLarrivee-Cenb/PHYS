C
	PROGRAM		VAXSTD
C
C	THIS PROGRAM IS TURNED ON BY THE BMG TO VAX LINK AND
C	TAKES DATA OUT OF THE VAXLINK:VAXSTD.LNK FILE AND MOVES IT
C	TO THE LOGS:STREND.DAT FILE EVERY SHIFT. THE BMG PROGRAM VAXSTD
C	INITIATES THIS SEQUENCE ABOUT 15 MINUTES AFTER THE END OF EVERY
C	SHIFT
C
	IMPLICIT NONE
C
	STRUCTURE	/RECX/
C
		CHARACTER*3	ORIG	!ORIGINATOR INITIALS
		CHARACTER*32	ED	!ENGLISH DESCRIPTION
		CHARACTER*6	UNITS	!UNIT OF MEASURE
		CHARACTER*11	DATEX	!DATE IN FORM DD-MMM-YYYY
		CHARACTER*1	SHIFT	!SHIFT IF NECESSARY
		REAL*8		VALUE	!VALUE
		CHARACTER*32	SPARE	!SPARE ROOM
C
	END STRUCTURE
C
	RECORD/RECX/RECX
C
	CHARACTER*12		DATEX
C
	INTEGER*4		I,J,K,L,UFO_OPEN
	INTEGER*4		XXX(5)/1698,1305,1699,1306,1203/
C
	REAL*4			BMG(7),IND(3)
	REAL*4			VALU(24),ACCUM,OBS,TEMP(5)
C
	EXTERNAL	UFO_OPEN
C
	OPEN	(UNIT=1,FILE='LOGS:STREND.DAT',STATUS='OLD',
	1	 ACCESS='DIRECT',RECORDTYPE='FIXED',
	1	 FORM='UNFORMATTED',RECL=27,SHARED,USEROPEN=UFO_OPEN)
C
	READ	(1,REC=1)DATEX,VALU
C
	IF (DATEX(1:1) .EQ. ' ')DATEX(1:1)='0'
C
C	IF (DATBMG(6:6) .NE. DATEX(12:12))GOTO 9999	!CHECK SHIFT
C	IF (DATBMG(3:4) .NE. DATEX(1:2))GOTO 9999	!CHECK DAY
C
		OPEN	(UNIT=3,FILE='LOGS:CNC_SHIFT.DAT',STATUS='OLD',SHARED,
	1		RECL=2,FORM='UNFORMATTED',RECORDTYPE='FIXED',
	1		USEROPEN=UFO_OPEN,ACCESS='DIRECT')
C
	DO 999	I=1,5
C
		READ	(3,REC=XXX(I))ACCUM,OBS	!LAST HOUR SIO2 COMP
C
		IF (OBS .EQ. 0)THEN 
			TEMP(I)=0
		ELSE
			TEMP(I)=ACCUM/OBS	!LAST HOUR AVG STEP COMP SIO2
		END IF
C
999	CONTINUE
C
		CLOSE	(UNIT=3)
C
	VALU(4)=TEMP(1)	!STEP 2 SIO2 TARGET
	VALU(5)=TEMP(2)	!STEP 2 COMPOSITE SIO2
	VALU(6)=TEMP(3)	!STEP 3 SIO2 TARGET
	VALU(7)=TEMP(4)	!STEP 3 COMPOSITE SIO2
	VALU(18)=TEMP(5)	!AMINE LBS/TON
C
	OPEN	(UNIT=2,FILE='RRDH:IND.DAT',STATUS='OLD',
	1		RECL=3,FORM='UNFORMATTED',USEROPEN=UFO_OPEN,
	1		RECORDTYPE='FIXED',ACCESS='DIRECT')
C
	READ	(2,REC=1)IND
C
	CLOSE	(UNIT=2)
C
	VALU(1)=IND(1)	!STEP 12 IND SIO2
	VALU(2)=IND(2)	!STEP 3 IND SIO2
	VALU(3)=IND(3)	!TOTAL MINE IND SIO2
C
	WRITE	(1,REC=1)DATEX,VALU
C
	IF (DATEX(12:12) .EQ. '3')THEN
C
		OPEN	(UNIT=8,FILE='LOGS1:MINNTAC.DAT',STATUS='OLD',
	1		RECORDTYPE='FIXED',FORM='UNFORMATTED',RECL=24,
	1		SHARED,ACCESS='DIRECT',USEROPEN=UFO_OPEN)
C
		RECX.VALUE=VALU(3)
		RECX.ORIG='WJB'
		RECX.ED='MINE CRUDE IND SIO2             '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='PCT   '
		RECX.SHIFT=DATEX(12:12)
		RECX.SPARE='VAXSTD                          '
C
		WRITE	(8,REC=138)RECX
C
		RECX.VALUE=VALU(5)
		RECX.ORIG='WJB'
		RECX.ED='STEP 2 NOLA COMPOSITE SIO2      '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='PCT   '
		RECX.SHIFT=DATEX(12:12)
C
		WRITE	(8,REC=139)RECX
C
		RECX.VALUE=VALU(7)
		RECX.ORIG='WJB'
		RECX.ED='STEP 3 NOLA COMPOSITE SIO2      '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='PCT   '
		RECX.SHIFT=DATEX(12:12)
C
		WRITE	(8,REC=140)RECX
C
		RECX.VALUE=VALU(18)
		RECX.ORIG='WJB'
		RECX.ED='AMINE POUNDS PER TON            '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='LBS/TN'
		RECX.SHIFT=DATEX(12:12)
C
		WRITE	(8,REC=141)RECX
C
		CLOSE	(UNIT=8)
C
	END IF
C
	IF (DATEX(12:12) .EQ. '1')THEN
C
		OPEN	(UNIT=8,FILE='LOGS1:MINNTAC.DAT',STATUS='OLD',
	1		RECORDTYPE='FIXED',FORM='UNFORMATTED',RECL=24,
	1		SHARED,ACCESS='DIRECT',USEROPEN=UFO_OPEN)
C
		RECX.VALUE=VALU(3)
		RECX.ORIG='WJB'
		RECX.ED='MINE CRUDE IND SIO2             '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='PCT   '
		RECX.SHIFT=DATEX(12:12)
		RECX.SPARE='VAXSTD                          '
C
		WRITE	(8,REC=142)RECX
C
		RECX.VALUE=VALU(5)
		RECX.ORIG='WJB'
		RECX.ED='STEP 2 NOLA COMPOSITE SIO2      '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='PCT   '
		RECX.SHIFT=DATEX(12:12)
C
		WRITE	(8,REC=143)RECX
C
		RECX.VALUE=VALU(7)
		RECX.ORIG='WJB'
		RECX.ED='STEP 3 NOLA COMPOSITE SIO2      '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='PCT   '
		RECX.SHIFT=DATEX(12:12)
C
		WRITE	(8,REC=144)RECX
C
		RECX.VALUE=VALU(18)
		RECX.ORIG='WJB'
		RECX.ED='AMINE POUNDS PER TON            '
		RECX.DATEX=DATEX(1:11)
		RECX.UNITS='LBS/TN'
		RECX.SHIFT=DATEX(12:12)
C
		WRITE	(8,REC=145)RECX
C
		CLOSE	(UNIT=8)
C
	END IF
C
9999	CONTINUE
C
	CLOSE	(UNIT=1)
	CLOSE	(UNIT=2)
C
	CALL	EXIT
C
	END
