CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		TRL               
C                              
C		               
C               
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	
	IMPLICIT INTEGER (A-Z)      
C
	EXTERNAL UFO_OPEN
C
	INCLUDE '($PRCDEF)'
C
c
c
c
c
	STRUCTURE /SHIFT/
C
		CHARACTER 	DS*7		! 1-6=YYMMDD  7=SHIFT   (KEY 0)
		INTEGER		INPTIME(2)	! INPUT TIME
		CHARACTER 	FOREMAN*14
		CHARACTER 	TL*14
		CHARACTER 	OPER*14
C
		REAL		TPH(18)
		REAL		LGRIND(18)
		REAL 		OPHRS(18)
C
		INTEGER		INDEX(2,40)
		CHARACTER	DELAYS(40)*64
C
		REAL		GRINDS(3)
		REAL		CNOLA(3)
		REAL		SIL(3)
		REAL		TARG(3)
		REAL		RECV(3)
		REAL		BINS(3)
		REAL		RAW(2)
		REAL		FLOC(3)
		INTEGER		DOWN(18)	! 1=DOWN
		REAL		FLSIL
		REAL		FLFE
		REAL		AMINE
		INTEGER		BANKS(4)	! 1=DOWN
		REAL		FLREC
		REAL		CT
		REAL		FT
		INTEGER		LR		! LINES RUNNING
		REAL		AL		! AVERAGE LINES
		INTEGER		FPLUGS
		INTEGER		DIKE
		INTEGER		PIT
		CHARACTER	RES*5
		INTEGER		FLXBINLVL
		CHARACTER*4	FROTHSTAT
		INTEGER 	FLUXSTAT
		INTEGER		FLXTM(2)
		CHARACTER*3	AGBINS(5)
		INTEGER		AGTANKS(6)
		LOGICAL		SPC2,SPC3
C
		CHARACTER	MFLOSS*80
		CHARACTER	HKEEP(3)*80
		LOGICAL		SAFE
		CHARACTER	SAFEMSG*160
		CHARACTER	UTIL(3)*80
		CHARACTER	CTPROB(3)*80
C
		CHARACTER	MDOWN(168)*40
C
		INTEGER  	 SST(2,2,15,20)         ! STOP TIME, START TIME
c
		REAL	       	REALTIME	 !time since beginning of shift
		LOGICAL		SPC2S,SPC3S	!in control for shift
C
		REAL		RRATIO		!RECOVERY RATIO
		REAL		LFT(7)		!FINE TAILS BY SECTION
		REAL		LCT(18)		!COARSE TAILS BY LINE
		CHARACTER	MFLOSS2*80   !added to mag loss by rjs 14mar94
	END STRUCTURE
C
	RECORD /SHIFT/ DAT,DATX2,DATZ
c
c
C
	CHARACTER FLSLABEL*30/
	1	'FLOAT FEED SIO2               '/
	CHARACTER LABEL(9)*30/
	1	'FLOT FEED DAVIS TUBE RECOVERY ',
	1	'FLOT FEED DAVIS TUBE SIL DIFF ',
	1	'FLOT TAILS IRON               ',
	1	'AMINE EFFICIENCY-BANK 1       ',
	1	'AMINE EFFICIENCY-BANK 2       ',
	1	'AMINE EFFICIENCY-BANK 3       ',
	1	'AMINE EFFICIENCY-BANK 4       ',
	1	'AMINE EFFICIENCY-TOTAL        ',
	1	'RECOVERY RATIO                '/
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	CHARACTER ADATE*11,HSKEY*4,DATEX*12,ASCSH,AT*11,AISH*3,dayshift*3,
	1dkey*7
C
C
C

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	INTEGER BTIM(2)
C
	CHARACTER MHR*2,MINIT*2,TT*7,DAY1*1/'1'/,TTIME*16,ASHIFT*4,SINP,
	1	DATTIM*23,ATIM*11,KD*6,BS,ES
C
C
	REAL PA,PC,PM,RSIL
C
	INTEGER DATF(2),IS,IH,BDB(2),EDB(2)
C
C
C
C
	CHARACTER DX*12,AJ
C
	REAL A,B
C
	DOUBLE PRECISION RR,X2(12),
	1		 MEAN(12),SD(12),NH(12)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
	CHARACTER TIMBUF*23
C
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
c
	structure /bozo2/
c
		character*4	key		! yymm	(primary key)
		real		msil(3,31)	! mine ind. sio2 by shift,day
		real		cr12(3,31)	! crusher +1/2 by shift,day
		real 		flfr(3,31)	! flf davis tube recovery
		real		flfs(3,31)	! flf davis tube sio2
		real		fls(3,31)	! flf sio2
		real		flts(3,31)	! flot tails sio2
		real		aeff(4,3,31)	! amine efficiency by cell
c
c
	end structure
c
	record /bozo2/ hsd
c
	CHARACTER BD*11,ED*11,AST*11,AET*11,EKEY*4,KEY*4,DD*23
	INTEGER*2 DDD(7)
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C
C	   shift report file, this file is in DESCENDING order.
C
	OPEN (UNIT=44,FILE='USER_D:[METREP.CSHIFT]SHIFT_DELAYS.DAT',
	1	ACCESS='KEYED',STATUS='OLD',READONLY)
C
C
C
C
C
334	WRITE (6,*) ' '
	WRITE (6,*) ' '
	WRITE (6,*) ' ENTER STARTING DATE-SHIFT    (ie. 03-MAR-1992-2)'
C
	READ (5,80) MM,DD
C
	BD=DD(1:11)
C
	BS=DD(13:13)
	READ (BS,'(I1)')IBS
	IF (IBS .EQ. 0) IBS=1
C
80	FORMAT (Q,A)
C
C
C
C
3344	WRITE (6,*) ' '
	WRITE (6,*) ' '
	WRITE (6,*) ' ENTER ENDING DATE-SHIFT    (ie.  04-MAR-1992-3)'
C
	READ (5,80) MM,DD
	ED=DD(1:11)
	ES=DD(13:13)
	READ (ES,'(I1)')IES
C
	WRITE (6,*) ' '
	WRITE (6,*) ' '
	WRITE (6,*) ' '
C
C
	WRITE (6,*)' '
	WRITE (6,*)' '
	WRITE (6,*)' ENTER SHIFT (BLANK=  ALL 3 SHIFTS)'
	WRITE (6,*)' '
C
	READ (5,373) ISH
373	FORMAT (I1)
C
	IF (ISH .LT. 1 .OR. ISH .GT. 3) THEN
		IB=1
		IE=3
		AISH='1-3'
	ELSE
		WRITE (AISH,'(I1)')ISH
		IB=ISH
		IE=ISH
	END IF
	CALL SYS$BINTIM (BD,BDB)
	CALL SYS$BINTIM (ED,EDB)
C
	CALL SYS$NUMTIM (DDD,BDB)
	CALL SYS$ASCTIM (,AT,BDB,)
C
	HSKEY(1:2)=AT(10:11)
	LL=DDD(2)
	WRITE (HSKEY(3:4),'(I2)')LL 
	IF (HSKEY(3:3) .EQ. ' ') HSKEY(3:3)='0'
C
	ISMON=DDD(2)
	ISDAY=DDD(3)
C
C
	CALL SYS$NUMTIM (DDD,EDB)
	CALL SYS$ASCTIM (,AT,EDB,)
C
	EKEY(1:2)=AT(10:11)
	LL=DDD(2)
	WRITE (EKEY(3:4),'(I2)') LL
	IF (EKEY(3:3) .EQ. ' ') EKEY(3:3)='0'
C
	IEMON=DDD(2)
	IEDAY=DDD(3)
C
	OPEN (UNIT=91,FILE='MET_P:HALFSIL2.DAT',STATUS='OLD',
	1	ACCESS='KEYED',SHARED,ERR=1800,READONLY)
C
C
c
c
C
	KEY=HSKEY
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C
C
	JFIRST=0
	JLAST=0
C
C
C
	DO WHILE (KEY .LE. EKEY)
C
C
C
C
C
C
333	READ (91,KEY=KEY,IOSTAT=M) HSD
C
C
C
	if (m .ne. 0) STOP ' FILE BEING UPDATED- TRY LATER'
C
C
C
C
CCCCCCCCCCCCCCC
C
C		check if its first pass and if only 1 month asked for
c
C
C
C
	IF (HSKEY .EQ. EKEY) THEN
		LD=ISDAY
		LDE=IEDAY
		JLAST=1
	ELSE IF (KEY .EQ. HSKEY) THEN
		LD=ISDAY
		LDE=31
	ELSE IF (KEY .EQ. EKEY) THEN
		LD=1
		LDE=IEDAY
		JLAST=1
	ELSE
		LD=1
		LDE=31
	END IF
C
C
C
C
	do 999 J=LD,LDE
c
C
	IF (JFIRST .EQ. 0) THEN
		ISAVE=IB
		IB=IBS
		JFIRST=1
	ELSE
		IB=ISAVE
	END IF
C
	IF (JLAST .NE.0) THEN
		IF (J .EQ. IEDAY) IE=IES
	END IF
C
	DO 998 I=IB,IE
C
		IF (HSD.MSIL(I,J) .LE. 0) GO TO 800
C
		MEAN(1)=MEAN(1)+HSD.MSIL(I,J)
		NH(1)=NH(1)+1
C
800		IF (HSD.CR12(I,J) .LE. 0) GO TO 801
C
		MEAN(2)=MEAN(2)+HSD.CR12(I,J)
		NH(2)=NH(2)+1
C
801		IF (HSD.FLFR(I,J) .LE. 0) GO TO 802
C
		MEAN(3)=MEAN(3)+HSD.FLFR(I,J)
		X2(3)=X2(3)+HSD.FLFR(I,J)**2
		NH(3)=NH(3)+1
C
802		IF (HSD.FLS(I,J) .LE. 0 .OR. HSD.FLFS(I,J) .LE. 0)GOTO 8034
C
		RR=HSD.FLS(I,J)-HSD.FLFS(I,J)
C 
		MEAN(4)=MEAN(4)+RR
		X2(4)=X2(4)+RR**2
		NH(4)=NH(4)+1
C
8034		IF (HSD.FLS(I,J) .LE. 0) GO TO 803
C
		MEAN(5)=MEAN(5)+HSD.FLS(I,J)
		X2(5)=X2(5)+HSD.FLS(I,J)**2
		NH(5)=NH(5)+1
C
803		NNN=0
C
		IF (HSD.FLTS(I,J) .LE. 0) GO TO 900
C
		RR=-.89484*HSD.FLTS(I,J)+72.13502
C
		MEAN(6)=MEAN(6)+RR
		X2(6)=X2(6)+RR**2
		NH(6)=NH(6)+1
C
900		IF (HSD.AEFF(1,I,J) .LE. 0) GO TO 901
C
		MEAN(7)=MEAN(7)+HSD.AEFF(1,I,J)
		X2(7)=X2(7)+HSD.AEFF(1,I,J)**2
		NH(7)=NH(7)+1
		NNN=NNN+1
C
901		IF (HSD.AEFF(2,I,J) .LE. 0) GO TO 902
C
		MEAN(8)=MEAN(8)+HSD.AEFF(2,I,J)
		X2(8)=X2(8)+HSD.AEFF(2,I,J)**2
		NH(8)=NH(8)+1
		NNN=NNN+1
C
902		IF (HSD.AEFF(3,I,J) .LE. 0) GO TO 903
C
		MEAN(9)=MEAN(9)+HSD.AEFF(3,I,J)
		X2(9)=X2(9)+HSD.AEFF(3,I,J)**2
		NH(9)=NH(9)+1
		NNN=NNN+1
C
903		IF (HSD.AEFF(4,I,J) .LE. 0) GO TO 904
C
		MEAN(10)=MEAN(10)+HSD.AEFF(4,I,J)
		X2(10)=X2(10)+HSD.AEFF(4,I,J)**2
		NH(10)=NH(10)+1
		NNN=NNN+1
C
904		TOT=HSD.AEFF(1,I,J)+HSD.AEFF(2,I,J)+HSD.AEFF(3,I,J)+
	1		HSD.AEFF(4,I,J)
C
		IF (TOT .LE. 0) GO TO 998
C
		RR=TOT/NNN
C
		MEAN(11)=MEAN(11)+RR
		X2(11)=X2(11)+RR**2
		NH(11)=NH(11)+1
C
C
CCCCCCCCCCCCCCCC
C
C	recovery ratio calculation
C
	WRITE (DKEY(5:6),'(I2)') J
	IF (DKEY(5:5) .EQ. ' ') DKEY(5:5)='0'
	WRITE (DKEY(7:7),'(I1)') I
	DKEY=KEY//DKEY(5:7)
C
585	READ (44,KEY=DKEY,IOSTAT=MM) DAT
C
	IF (MM .EQ. 52) THEN
		CALL LIB$WAIT(1.)
		GO TO 585
	ELSE IF (MM .NE. 0) THEN
		GO TO 998
	END IF
C
C
	N48=0
	RSIL=DAT.SIL(2)+DAT.SIL(3)
	IF (DAT.SIL(2) .GT. 0) N48=1
	IF (DAT.SIL(3) .GT. 0) N48=N48+1
	RSIL=RSIL/N48
C
	RR=-2*(DAT.FLSIL-RSIL)**2+(DAT.FLSIL-RSIL)+100.
	IF (RR .EQ. 0) GO TO 998
	RR=10000.*((DAT.FLSIL-HSD.FLTS(I,J))/(RSIL-HSD.FLTS(I,J)))/RR
C
	if (hsd.flts(i,j) .le. 0) go to 998
C
		MEAN(12)=MEAN(12)+RR
		X2(12)=X2(12)+RR**2
		NH(12)=NH(12)+1
c
998		CONTINUE
C
999	CONTINUE
c
C
	READ (KEY(3:4),'(BN,I2)') MX
	MX=MX+1
	WRITE (KEY(3:4),'(I2)') MX
	IF (KEY(3:3) .EQ. ' ') KEY(3:3)='0'
C
C
C
	END DO
C
	close (91)
C
C
C
C
	DO 45 I=1,12
		IF (I .LT. 3) GO TO 45
C
		IF (NH(I) .LE. 1) GO TO 45
C
		SD(I)=SQRT((NH(I)*X2(I)-MEAN(I)**2)/(NH(I)*(NH(I)-1)))
		MEAN(I)=MEAN(I)/NH(I)
C
45	CONTINUE
C
	WRITE (6,1100)BD,BS,ED,ES,AISH
1100	FORMAT ('1',5X,'FROM ',A,'-',A,'  TO ',A,'-',A,3X,'SHIFT ',A3//
	1	' ',33X,' MEAN',1X,'N-COUNT',1X,'STD DEV'/)
C
	LAB=1
	DO 1201 I=3,12
		IF (I .EQ. 5) THEN 
		WRITE (6,1101) FLSLABEL,MEAN(I),NH(I),SD(I)
		GO TO 1201
		END IF
C
		WRITE (6,1101) LABEL(LAB),MEAN(I),NH(I),SD(I)
C
1101		FORMAT (' ',A,3F8.2)
C
1200		LAB=LAB+1
1201	CONTINUE
C
C
1800	STOP
	END
