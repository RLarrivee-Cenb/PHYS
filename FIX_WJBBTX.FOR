	external ufo_open
	INCLUDE 'FMS$EXAMPLES:FDVDEF'
	double precision wav(9),wav3(9),xx2,xx3
	character timbuf*11,as
c
C
	INTEGER*2  KEYTABLE(24)/FDV$K_KF_NTR,FDV$K_KF_NONE,
	1		       	FDV$K_KF_NXT,FDV$K_KF_NONE,
	1		       	FDV$K_KF_PRV,FDV$K_KF_NONE,
	1			FDV$K_KF_SFW,FDV$K_KF_NONE,
	1			FDV$K_KF_SBK,FDV$K_KF_NONE,
	1		       	FDV$K_KF_NXT,107,
	1			fdv$k_kf_nxt,1037,
	1			fdv$k_kf_ntr,235,
	1			FDV$K_KF_NTR,269,
	1		       FDV$K_KF_NXT,FDV$K_AR_DOWN,
	1		       FDV$K_KF_PRV,FDV$K_AR_UP,	
	1		       FDV$K_KF_PRV,FDV$K_FK_F12/	
CCCCCCCCCCCCC
C
	INTEGER  WORKSPACE( 3 ),	!General workspace
	1	 CHECKWKSP( 3 ),	!Check workspace
	2	 TCA( 3 ),		!Terminal Control Area
    	3	 GASN_FORM(500),	!Storage for memory resident form
    	4	 GASD_FORM(750) 	!Storage for memory resident form
C
	integer flag/64/
	CHARACTER AV*10
C
C
C
	STRUCTURE /X/
		UNION
			MAP
				CHARACTER INP*300
			END MAP
C
			MAP
				CHARACTER STP2(10)*10, ST3(10)*10,
	1			  FLF(2)*10, REPLY
			END MAP
		END UNION
	END STRUCTURE
C
C
	RECORD /X/ DAT
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
	CALL FDV$ATERM( %DESCR(TCA),12 ,2)
	CALL FDV$AWKSP( %DESCR(WORKSPACE), 2000 )
	CALL FDV$LOPEN( 'user_d:[METREP.LAB45]FIX_WJBBTX', 1 )
	CALL FDV$SPON ()
C
C
	CALL FDV$DFKBD (%DESCR(KEYTABLE),12)
C
	CALL FDV$CDISP ('FIX_WJBBTX')                   
C
C
		OPEN (UNIT=78,FILE='MET_P:WJBBTX.DAT',STATUS='old',
	1	recordtype='fixed',recl=200,SHARED,USEROPEN=UFO_OPEN)
C
c
	read (78,2555)TIMBUF(1:11),AS,(WAV(I5),I5=1,9),
	1		(WAV3(J),J=1,9),FS,F2,XX2,XX3
2555	FORMAT (A11,A1,20F7.2,2f7.1)
c
C
C
	CALL FDV$PUT (TIMBUF,'DATE')
	CALL FDV$PUT (AS,'SHIFT')
C
	DO 50 I=1,9
	WRITE (AV,'(F10.2)') WAV(I)
	CALL FDV$PUT (AV,'STP2',I)	
	WRITE (AV,'(F10.2)') WAV3(I)
	CALL FDV$PUT (AV,'ST3',I)
50	CONTINUE
C
C
	WRITE (AV,'(F10.0)') XX2
	CALL FDV$PUT (AV,'STP2',10)	
	WRITE (AV,'(F10.0)') XX3
	CALL FDV$PUT (AV,'ST3',10)	
C	
C
	WRITE (AV,'(F10.2)') FS
	CALL FDV$PUT (AV,'FLF',1)	
	WRITE (AV,'(F10.2)') F2
	CALL FDV$PUT (AV,'FLF',2)	
C
C
C
1	CALL FDV$GETAL (DAT.INP,LX,'STP2',1)
C	
C
C
C
	CALL FDV$GET (DAT.REPLY,LL,'REPLY')
	IF (DAT.REPLY .EQ. 'A' .OR. 
	1	DAT.REPLY .EQ. 'a') THEN
		GO TO 99
	ELSE IF (DAT.REPLY .eq. 'N' .or. dat.reply .eq. 'n') then
		CALL FDV$PUT (' ','REPLY')
		GO TO 1
	END IF
C
C
	DO 60 I=1,9
	READ (DAT.STP2(I),'(F10.0)') WAV(I)
	READ (DAT.ST3(I),'(F10.0)') WAV3(I)
60	CONTINUE
C
	READ (DAT.STP2(10),'(F10.0)') XX2
	READ (DAT.ST3(10),'(F10.0)') XX3
C
	READ (DAT.FLF(1),'(F10.0)') FS
	READ (DAT.FLF(2),'(F10.0)') F2
C
CCCCCCCCCCCCCCCCCCCCCCCC
	rewind (78)
C
	WRITE (78,255)TIMBUF(1:11),AS,(WAV(I5),I5=1,9),
	1		(WAV3(J),J=1,9),FS,F2,XX2,XX3
255	FORMAT (A11,A1,20F7.2,2f7.1)
C
	CLOSE (78)
C
99	CALL FDV$LCLOS
	CALL FDV$SPADA (0)
	CALL FDV$DEL ('LINEDATA')
	CALL FDV$DWKSP (%DESCR(WORKSPACE))
	CALL FDV$DTERM(%DESCR(TCA))
C
C
C
669	STOP
	END
