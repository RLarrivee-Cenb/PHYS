CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		TRL               
C                              
C		               
C               
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	
	IMPLICIT INTEGER (A-Z)      
C
	EXTERNAL UFO_OPEN
C
	INCLUDE '($PRCDEF)'
C
C
c
c
c
	STRUCTURE /SHIFT/
C
		CHARACTER 	DS*7		! 1-6=YYMMDD  7=SHIFT   (KEY 0)
		INTEGER		INPTIME(2)	! INPUT TIME
		CHARACTER 	FOREMAN*14
		CHARACTER 	TL*14
		CHARACTER 	OPER*14
C
		REAL		TPH(18)
		REAL		LGRIND(18)
		REAL 		OPHRS(18)
C
		INTEGER		INDEX(2,40)
		CHARACTER	DELAYS(40)*64
C
		REAL		GRINDS(3)
		REAL		CNOLA(3)
		REAL		SIL(3)
		REAL		TARG(3)
		REAL		RECV(3)
		REAL		BINS(3)
		REAL		RAW(2)
		REAL		FLOC(3)
		INTEGER		DOWN(18)	! 1=DOWN
		REAL		FLSIL
		REAL		FLFE
		REAL		AMINE
		INTEGER		BANKS(4)	! 1=DOWN
		REAL		FLREC
		REAL		CT
		REAL		FT
		INTEGER		LR		! LINES RUNNING
		REAL		AL		! AVERAGE LINES
		INTEGER		FPLUGS
		INTEGER		DIKE
		INTEGER		PIT
		CHARACTER	RES*5
		INTEGER		FLXBINLVL
		CHARACTER*4	FROTHSTAT
		INTEGER 	FLUXSTAT
		INTEGER		FLXTM(2)
		CHARACTER*3	AGBINS(5)
		INTEGER		AGTANKS(6)
		LOGICAL		SPC2,SPC3
C
		CHARACTER	MFLOSS*80
		CHARACTER	HKEEP(3)*80
		LOGICAL		SAFE
		CHARACTER	SAFEMSG*160
		CHARACTER	UTIL(3)*80
		CHARACTER	CTPROB(3)*80
C
		CHARACTER	MDOWN(168)*40
C
		INTEGER  	 SST(2,2,15,20)         ! STOP TIME, START TIME
c
		REAL	       	REALTIME	 !time since beginning of shift
		LOGICAL		SPC2S,SPC3S	!in control for shift
C
		REAL		RRATIO		!RECOVERY RATIO
		REAL		LFT(7)		!FINE TAILS BY SECTION
		REAL		LCT(18)		!COARSE TAILS BY LINE
		CHARACTER	MFLOSS2*80   !added to mag loss by rjs 14mar94
	END STRUCTURE
C
	RECORD /SHIFT/ DIT,DATX2,DATZ
C
C
	CHARACTER TWELV*1/12/,PUT*3,AINTV/'1'/,
	1	PO*3/'[5i'/,POF*3/'[4i'/,ES/27/,STR*4,STRL*4
C
	CHARACTER FLSLABEL*30/
	1	'FLOAT FEED SIO2               '/
	CHARACTER LABEL(9)*30/
	1	'FLOT FEED DAVIS TUBE RECOVERY ',
	1	'FLOT FEED DAVIS TUBE SIL DIFF ',
	1	'FLOT TAILS IRON               ',
	1	'AMINE EFFICIENCY-BANK 1       ',
	1	'AMINE EFFICIENCY-BANK 2       ',
	1	'AMINE EFFICIENCY-BANK 3       ',
	1	'AMINE EFFICIENCY-BANK 4       ',
	1	'AMINE EFFICIENCY-TOTAL        ',
	1	'RECOVERY RATIO                '/
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	CHARACTER ADATE*11,HSKEY*4,DATEX*12,ASCSH,AT*11,NAMES(4)*10,
	1MON(12)*3/'JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP',
	1'OCT','NOV','DEC'/,DDT*11,DKEY*7
C
C
C

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	INTEGER BTIM(2),DAT(2),SS(4)
C
	CHARACTER MHR*2,MINIT*2,TT*7,DAY1*1/'1'/,TTIME*16,ASHIFT*4,SINP,
	1	DATTIM*23,ATIM*11,KD*6
C
C
	REAL PA,PC,PM,RSIL
C
	INTEGER DATF(2),IS,IH,BDB(2),EDB(2)
C
C
C
C
	CHARACTER DX*12,AJ
C
	REAL A,B
C
	DOUBLE PRECISION RR,X2(4,12),
	1		 MEAN(4,12),SD(4,12),NH(4,12)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
	CHARACTER TIMBUF*23
C
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
c
	structure /bozo2/
c
		character*4	key		! yymm	(primary key)
		real		msil(3,31)	! mine ind. sio2 by shift,day
		real		cr12(3,31)	! crusher +1/2 by shift,day
		real 		flfr(3,31)	! flf davis tube recovery
		real		flfs(3,31)	! flf davis tube sio2
		real		fls(3,31)	! flf sio2
		real		flts(3,31)	! flot tails sio2
		real		aeff(4,3,31)	! amine efficiency by cell
c
c
	end structure
c
	record /bozo2/ hsd
c
	CHARACTER BD*11,ED*11,AST*11,AET*11,EKEY*4,KEY*4
	INTEGER*2 DDD(7)
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C	   shift report file, this file is in DESCENDING order.
C
	OPEN (UNIT=44,FILE='USER_D:[METREP.CSHIFT]SHIFT_DELAYS.DAT',
	1	ACCESS='KEYED',STATUS='OLD',READONLY)
C
C
C
C
	OPEN (UNIT=77,FILE='USER_D:[METREP]FNAMEFILE.DAT',STATUS='OLD',
	1	ACCESS='DIRECT',RECL=512,FORM='FORMATTED')
C
C
	READ (77,20,REC=1)NAMES
20	FORMAT (4A10)
C
	CLOSE (77)
C
C
C
334	WRITE (6,*) ' '
	WRITE (6,*) ' '
	WRITE (6,*) ' ENTER STARTING DATE    (ie. 03-MAR-1992)'
C
	READ (5,80) MM,BD
80	FORMAT (Q,A)
C
	IF (MM .EQ. 10)BD='0'//BD(1:10)
	IF (.NOT. (MM .EQ. 10 .OR. MM .EQ. 11)) GO TO 334
C
C
C
3344	WRITE (6,*) ' '
	WRITE (6,*) ' '
	WRITE (6,*) ' ENTER ENDING DATE    (ie.  04-MAR-1992)'
C
	READ (5,80) MM,ED
C
	IF (MM .EQ. 10)ED='0'//ED(1:10)
	IF (.NOT. (MM .EQ. 10 .OR. MM .EQ. 11)) GO TO 3344
	WRITE (6,*) ' '
	WRITE (6,*) ' '
	WRITE (6,*) ' '
C
	STR=ES//PO
	STRL=ES//POF
C
		WRITE (6,229)STR
229		FORMAT (' ',A)
C
	CALL SYS$BINTIM (BD,BDB)
	CALL SYS$BINTIM (ED,EDB)
C
	CALL SYS$NUMTIM (DDD,BDB)
	CALL SYS$ASCTIM (,AT,BDB,)
C
	HSKEY(1:2)=AT(10:11)
	LL=DDD(2)
	WRITE (HSKEY(3:4),'(I2)')LL 
	IF (HSKEY(3:3) .EQ. ' ') HSKEY(3:3)='0'
C
	ISMON=DDD(2)
	ISDAY=DDD(3)
C
C
	CALL SYS$NUMTIM (DDD,EDB)
	CALL SYS$ASCTIM (,AT,EDB,)
C
	EKEY(1:2)=AT(10:11)
	LL=DDD(2)
	WRITE (EKEY(3:4),'(I2)') LL
	IF (EKEY(3:3) .EQ. ' ') EKEY(3:3)='0'
C
	IEMON=DDD(2)
	IEDAY=DDD(3)
C
	OPEN (UNIT=91,FILE='MET_P:HALFSIL2.DAT',STATUS='OLD',
	1	ACCESS='KEYED',SHARED,ERR=1800,READONLY)
C
C
c
c
C
	KEY=HSKEY
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C
C
C
C
	DO WHILE (KEY .LE. EKEY)
C
C
C
C
C
C
333	READ (91,KEY=KEY,IOSTAT=M) HSD
C
C
C
	if (m .ne. 0) STOP ' FILE BEING UPDATED- TRY LATER'
C
C
C
C
CCCCCCCCCCCCCCC
C
	IF (HSKEY .EQ. EKEY) THEN   	!check if same month asked for in
		LD=ISDAY                ! both start and stop returns
		LDE=IEDAY
	ELSE IF (KEY .EQ. HSKEY) THEN
		LD=ISDAY
		LDE=31
	ELSE IF (KEY .EQ. EKEY) THEN
		LD=1
		LDE=IEDAY
	ELSE
		LD=1
		LDE=31
	END IF
C
C
C
C
	do 999 J=LD,LDE
c
		WRITE (DDT(1:2),'(I2)') J
C
		READ (HSD.KEY(3:4),'(I2)') LXX
		DDT=DDT(1:2)//'-'//MON(LXX)//'-19'//HSD.KEY(1:2)
		CALL SYS$BINTIM (DDT,DAT)
C
		CALL PATTERN(DAT,SS)
C
	DO 998 I=1,3
C
		DO 56 LF=1,4
			IF (SS(LF) .EQ. I) GO TO 57
56		CONTINUE
C
		STOP ' NO MATCH'
C
C
C
57		IF (HSD.MSIL(I,J) .LE. 0) GO TO 800
C
		MEAN(LF,1)=MEAN(LF,1)+HSD.MSIL(I,J)
		NH(LF,1)=NH(LF,1)+1
C
800		IF (HSD.CR12(I,J) .LE. 0) GO TO 801
C
		MEAN(LF,2)=MEAN(LF,2)+HSD.CR12(I,J)
		NH(LF,2)=NH(LF,2)+1
C
801		IF (HSD.FLFR(I,J) .LE. 0) GO TO 802
C
		MEAN(LF,3)=MEAN(LF,3)+HSD.FLFR(I,J)
		X2(LF,3)=X2(LF,3)+HSD.FLFR(I,J)**2
		NH(LF,3)=NH(LF,3)+1
C
802		IF (HSD.FLS(I,J) .LE. 0 .OR. HSD.FLFS(I,J) .LE. 0)GOTO 8034
C
		RR=HSD.FLS(I,J)-HSD.FLFS(I,J)
C 
		MEAN(LF,4)=MEAN(LF,4)+RR
		X2(LF,4)=X2(LF,4)+RR**2
		NH(LF,4)=NH(LF,4)+1
C
8034		IF (HSD.FLS(I,J) .LE. 0) GO TO 803
C
		MEAN(LF,5)=MEAN(LF,5)+HSD.FLS(I,J)
		X2(LF,5)=X2(LF,5)+HSD.FLS(I,J)**2
		NH(LF,5)=NH(LF,5)+1
C
803		NNN=0
C
		IF (HSD.FLTS(I,J) .LE. 0) GO TO 900
C
		RR=-.89484*HSD.FLTS(I,J)+72.13502
C
		MEAN(LF,6)=MEAN(LF,6)+RR
		X2(LF,6)=X2(LF,6)+RR**2
		NH(LF,6)=NH(LF,6)+1
C
900		IF (HSD.AEFF(1,I,J) .LE. 0) GO TO 901
C
		MEAN(LF,7)=MEAN(LF,7)+HSD.AEFF(1,I,J)
		X2(LF,7)=X2(LF,7)+HSD.AEFF(1,I,J)**2
		NH(LF,7)=NH(LF,7)+1
		NNN=NNN+1
C
901		IF (HSD.AEFF(2,I,J) .LE. 0) GO TO 902
C
		MEAN(LF,8)=MEAN(LF,8)+HSD.AEFF(2,I,J)
		X2(LF,8)=X2(LF,8)+HSD.AEFF(2,I,J)**2
		NH(LF,8)=NH(LF,8)+1
		NNN=NNN+1
C
902		IF (HSD.AEFF(3,I,J) .LE. 0) GO TO 903
C
		MEAN(LF,9)=MEAN(LF,9)+HSD.AEFF(3,I,J)
		X2(LF,9)=X2(LF,9)+HSD.AEFF(3,I,J)**2
		NH(LF,9)=NH(LF,9)+1
		NNN=NNN+1
C
903		IF (HSD.AEFF(4,I,J) .LE. 0) GO TO 904
C
		MEAN(LF,10)=MEAN(LF,10)+HSD.AEFF(4,I,J)
		X2(LF,10)=X2(LF,10)+HSD.AEFF(4,I,J)**2
		NH(LF,10)=NH(LF,10)+1
		NNN=NNN+1
C
904		TOT=HSD.AEFF(1,I,J)+HSD.AEFF(2,I,J)+HSD.AEFF(3,I,J)+
	1		HSD.AEFF(4,I,J)
C
		IF (TOT .LE. 0) GO TO 998
C
		RR=TOT/NNN
C
		MEAN(LF,11)=MEAN(LF,11)+RR
		X2(LF,11)=X2(LF,11)+RR**2
		NH(LF,11)=NH(LF,11)+1
C
C
CCCCCCCCCCCCCCCC
C
C	recovery ratio calculation
C
	WRITE (DKEY(5:6),'(I2)') J
	IF (DKEY(5:5) .EQ. ' ') DKEY(5:5)='0'
	WRITE (DKEY(7:7),'(I1)') I
	DKEY=KEY//DKEY(5:7)
C
585	READ (44,KEY=DKEY,IOSTAT=MM) DIT
C
	IF (MM .EQ. 52) THEN
		CALL LIB$WAIT(1.)
		GO TO 585
	ELSE IF (MM .NE. 0) THEN
		GO TO 998
	END IF
C
C
	N48=0
	RSIL=DIT.SIL(2)+DIT.SIL(3)
	IF (DIT.SIL(2) .GT. 0) N48=1
	IF (DIT.SIL(3) .GT. 0) N48=N48+1
	RSIL=RSIL/N48
C
	RR=-2*(DIT.FLSIL-RSIL)**2+(DIT.FLSIL-RSIL)+100.
	IF (RR .EQ. 0) GO TO 998
	RR=10000.*((DIT.FLSIL-HSD.FLTS(I,J))/(RSIL-HSD.FLTS(I,J)))/RR
C
	if (hsd.flts(i,j) .le. 0) go to 998
C
		MEAN(LF,12)=MEAN(LF,12)+RR
		X2(LF,12)=X2(LF,12)+RR**2
		NH(LF,12)=NH(LF,12)+1
c
C
998		CONTINUE
C
999	CONTINUE
c
C
	READ (KEY(3:4),'(BN,I2)') MX
	MX=MX+1
	WRITE (KEY(3:4),'(I2)') MX
	IF (KEY(3:3) .EQ. ' ') KEY(3:3)='0'
C
C
C
	END DO
C
	close (91)
C
C
C
C
	DO 45 I=1,12
	DO 45 LF=1,4
		IF (I .LT. 3) GO TO 45
C
		IF (NH(LF,I) .LE. 1) GO TO 45
C
		SD(LF,I)=SQRT((NH(LF,I)*X2(LF,I)-MEAN(LF,I)**2)/
	1			(NH(LF,I)*(NH(LF,I)-1)))
C
		MEAN(LF,I)=MEAN(LF,I)/NH(LF,I)
C
45	CONTINUE
C
	WRITE (6,1100)BD,ED
1100	FORMAT ('1',5X,'FROM ',A,'  TO ',A/
	1	' ',33X,' MEAN',1X,'N-COUNT',1X,'STD DEV')
C
C
	DO 1300 LF=1,4
C
		WRITE (6,412)NAMES(LF)
412		FORMAT (1H ,A/)
C
	LAB=1
	DO 1201 I=3,12
		IF (I .EQ. 5) THEN 
		WRITE (6,1101) FLSLABEL,MEAN(LF,I),NH(LF,I),SD(LF,I)
		GO TO 1201
		END IF
C
		WRITE (6,1101) LABEL(LAB),MEAN(LF,I),NH(LF,I),SD(LF,I)
C
1101		FORMAT (' ',A,3F8.2)
C
1200		LAB=LAB+1
1201	CONTINUE
C
1300	CONTINUE
C
1800	WRITE (6,229)STRL
	STOP
	END
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	SUBROUTINE PATTERN (BTIM,SS)
C
	CHARACTER ADATE*11
	INTEGER SS(4),BTIM(2),NOFD,FNOFD(4),CTIM(2)
	INTEGER*2 NUM(7)
	INTEGER LIST(28)
	1	/1,1,1,1,1,1,1,0,0,0,0,3,3,3,3,3,3,3,0,2,2,2,2,2,2,2,0,0/
C
	CHARACTER*11   			                         
	1	FORD(4)/
	1	'02-MAR-1990',  	! #1  date that each of the four 
	2	'16-MAR-1990',      	! #2  crews start their midnight
	3	'23-MAR-1990',      	! #3   shift (shift 1)
	4	'09-MAR-1990'/           ! #4
C
C
	CALL LIB$DAY (NOFD,BTIM,)  !get day no. of passed time
C
C
	DO 44 I=1,4    	! get day no. of 4 starting dates
C
	CALL SYS$BINTIM (FORD(I),CTIM)  !convert sched. date to binary
C
44		CALL LIB$DAY (FNOFD(I),CTIM,)
C
C
	DO 45 I=1,4                	! calc shift no. of the day passed
C                                       ! to 'ADATE' for all 4 crews
C
	SS(I)=NOFD-FNOFD(I)+1  	!calc no. of days from base to now
C
	SS(I)=MOD(SS(I),28)             !get remainder after divide by 28
C
	IF (SS(I) .EQ. 0) SS(I)=28      !if remain.=0 then remain=28
C
	SS(I)=LIST(SS(I))               !get corresp. shift no. from 'list'
C
45	CONTINUE
C
C
	ICNT=0
	DO 46 I=1,4
46	IF (SS(I) .EQ. 0) ICNT=ICNT+1
C
C
	IF (ICNT .NE. 1) THEN
C
	WRITE (6,*) ' PATTERN SUBROUTINE DID NOT CALCULATE 3 SHIFTS'
	WRITE (6,*) ' CALL R.J. MAKI AT 7490'
	STOP
C
	END IF
C
C
C
	RETURN
C
C
	END
